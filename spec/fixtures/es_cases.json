{
  "description": "Test cases for Expected Shortfall (CVaR)",
  "spec_section": "§4.3",
  "formula": "ES_α = -mean(returns where returns ≤ -VaR_α)",
  "note": "ES is positive loss magnitude, ES >= VaR",
  "cases": [
    {
      "name": "es_exceeds_var",
      "input": {
        "returns": [-0.10, -0.05, -0.03, -0.01, 0.01, 0.03, 0.05, 0.07, 0.09, 0.10],
        "confidence": 0.90
      },
      "expected": 0.10,
      "tolerance": 0.001,
      "note": "ES >= VaR always; tail contains only -0.10"
    },
    {
      "name": "es_is_positive",
      "input": {
        "returns": [-0.05, -0.04, -0.03, -0.02, -0.01, 0.01, 0.02, 0.03, 0.04, 0.05],
        "confidence": 0.80
      },
      "expected": 0.045,
      "tolerance": 0.001,
      "note": "ES is positive loss magnitude"
    },
    {
      "name": "tail_average",
      "input": {
        "returns": [-0.10, -0.08, -0.05, -0.03, -0.01, 0.01, 0.03, 0.05, 0.08, 0.10],
        "confidence": 0.90
      },
      "expected": 0.10,
      "tolerance": 0.001,
      "note": "90% ES: VaR=0.055, tail=[-0.10]; ES=-mean(-0.10)=0.10"
    },
    {
      "name": "empty_returns",
      "input": {
        "returns": [],
        "confidence": 0.95
      },
      "expected": null
    }
  ]
}
